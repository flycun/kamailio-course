# 移除来自外部网络的不支持编解码器路由
# 确保只有指定的编解码器被允许通过，提高系统兼容性和安全性
# 1. 仅处理来自公共网络(外部)的消息
# 2. 仅处理UPDATE或INVITE方法的消息
# 3. 保留指定编解码器：PCMA, PCMU, telephone-event
# 4. 移除所有其他编解码器
route[REMOVE_CODECS_INBOUND] {
    # 检查消息是否来自外部网络
    if(isflagset(FLT_FROM_PUBLIC)){
        # 检查方法是否为UPDATE或INVITE
        if (!is_method("UPDATE|INVITE")) {
            return 0;
        }  
        # 检查SDP内容
        if (sdp_content()) {
            # 保留指定的编解码器：PCMA(G.711 A-law), PCMU(G.711 μ-law), telephone-event(RFC 2833 DTMF)
            sdp_keep_codecs_by_name("PCMA,PCMU,telephone-event");
            if (!msg_apply_changes() ) {
                xlog("L_INFO", "REMOVE_CODECS_INBOUND | REMOVING CODEC FAILED\n");
                return 0;
            }
            return 1;
        }
    }
}

