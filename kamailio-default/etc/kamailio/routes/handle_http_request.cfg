# 处理HTTP异步请求路由
# 向外部API发送路由请求并等待响应，实现动态路由决策
# 使用异步机制避免阻塞呼叫处理
route[HANDLE_HTTP_REQUEST] {
    # 初始化HTTP请求
    $http_req(all) = $null;              # 清空之前的HTTP请求数据
    $http_req(suspend) = 1;              # 设置挂起模式，事务等待响应时挂起
    $http_req(method) = "POST";          # 设置请求方法为POST
    $http_req(hdr) = "Content-Type: application/json";  # 设置JSON格式请求头
    
    # 构建JSON请求体，包含被叫用户名
    jansson_set("string", "to_user", $tU, "$var(http_routing_query)");
    xlog("L_INFO","API ASYNC ROUTING REQUEST: $var(http_routing_query)\n");
    $http_req(body) = $var(http_routing_query);  # 设置HTTP请求体
    
    # 创建新事务并发送异步HTTP查询
    t_newtran();                         # 创建新事务
    # 向API路由端点发送异步查询，响应由HANDLE_HTTP_RESPONSE路由处理
    http_async_query(HTTP_API_ROUTING_ENDPOINT, "HANDLE_HTTP_RESPONSE");
}