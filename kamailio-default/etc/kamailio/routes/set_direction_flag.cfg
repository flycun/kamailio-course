# 设置消息来源方向标志
# 该路由用于区分SIP消息是来自内部核心网络还是外部公共网络
# 1. 清理已设置的方向标志，确保判断准确性
# 2. 检查消息源IP是否在核心子网内
# 3. 根据来源设置相应标志：FLT_FROM_CORE(来自核心)或FLT_FROM_PUBLIC(来自公共网络)
# 4. 记录判断结果到日志
route[SET_DIRECTION_FLAG] {

	# 清理方向标志以确保干净的测试
	if(isflagset(FLT_FROM_CORE)) {
		resetflag(FLT_FROM_CORE);
	} else {
		resetflag(FLT_FROM_PUBLIC);
	}

    # 判断消息来源
    if (is_in_subnet( "$si", "CORESUBNET")) {
        xlog("L_INFO", "it's in the CORE subnet\n");
        setflag(FLT_FROM_CORE);
        return 1;
    }
    setflag(FLT_FROM_PUBLIC);
    xlog("L_INFO", "it's in the PUBLIC subnet\n");
    return 1;
}
